\documentclass[10pt, a4paper, onecolumn, oneside, titlepage, openany]{book}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{titlesec} % chapter on line with text
\usepackage{fancyhdr}
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue, %\ref{}
    filecolor=magenta, % \href{run:./file.txt}{File.txt}
    urlcolor=cyan, % \href{http://www.overleaf.com}{Link}
    pdftitle={Cisco CCNA}
    pdfpagemode=FullScreen,
    }
\usepackage{menukeys}
\usepackage{fancyvrb}

% table formatting
\setlength{\arrayrulewidth}{0.5mm} % border
\setlength{\tabcolsep}{18pt} % space from border (X axis)
\renewcommand{\arraystretch}{1.5} % space from border (Y axis)
\usepackage[format=hang,font=small,labelfont=bf]{caption} % bold table caption

% chapter formatting
\renewcommand{\chaptername}{}
\titleformat{\chapter}[hang]{\normalfont\huge\bfseries}{\chaptertitlename\ \thechapter.}{1em}{}

% decorative lines:
\renewcommand{\headrulewidth}{2pt}
\renewcommand{\footrulewidth}{2pt}
\pagestyle{fancy}
\fancyhf{}
    \chead{\leftmark}
    \cfoot{\thepage}
\fancypagestyle{plain}{
\fancyhf{}
    \chead{\leftmark}
    \cfoot{\thepage}
}

% verbatim formatting
\definecolor{device}{RGB}{0, 100, 200}
\definecolor{command}{RGB}{41, 182, 0}
\definecolor{nocommand}{RGB}{222, 0, 0}
\definecolor{showcommand}{RGB}{255, 80, 0}
\definecolor{warncommand}{RGB}{255, 80, 0}
\definecolor{root}{RGB}{222, 0, 0}
\definecolor{user}{RGB}{0, 150, 0}
\definecolor{dir}{RGB}{0, 100, 200}
\definecolor{file}{RGB}{77, 187, 101}
\definecolor{block}{RGB}{255, 80, 0}
\definecolor{comment}{RGB}{0, 182, 182}
\definecolor{background}{RGB}{240, 240, 240}
\renewcommand{\FancyVerbFormatLine}[1]{\colorbox{background}{#1}}


\title{\textbf{Linux Gentoo}}
\author{AISK11}
\date{March 2022}

\begin{document}
\maketitle
\tableofcontents


\chapter{System Info}
\section{System Hardware}
\begin{table}[h!]
\centering
\begin{tabular}{|c|c|}
    \hline
    \textbf{Hardware} & \textbf{Value} \\
    \hline
    CPU architecture & amd64\\
    CPU vendor & intel\\
    Motherboard & UEFI\\
    Hard Drive & NVMe\\
    WiFi & iwlwifi\\
    GPU & Nvidia\\
    \hline
\end{tabular}
\caption{System hardware overview.}
\label{table:1}
\end{table}

\section{System Software}
\begin{table}[h!]
\centering
\begin{tabular}{|c|c|}
    \hline
    \textbf{Hardware} & \textbf{Value} \\
    \hline
    RAID & no\\
    LVM & no (btrfs)\\
    Encryption & LUKS\\
    Root filesystem & btrfs\\
    SWAP & 4GB\\
    Bootloader & rEFInd\\
    Init & runit\\
    Virtualization & Xen\\
    \hline
\end{tabular}
\caption{System software overview.}
\label{table:2}
\end{table}


\chapter{Download}
\section{Download Gentoo ISO}
\begin{enumerate}
    \item \textbf{Download Gentoo ISO}
    \begin{itemize}
        \item \textbf{General Gentoo download page:}
\newline \url{https://www.gentoo.org/downloads/}
        \item \textbf{Gentoo mirrors:}
\newline \url{https://www.gentoo.org/downloads/mirrors/}
        \item \textbf{Gentoo bouncer mirror:}
\newline \url{https://bouncer.gentoo.org/fetch/root/all/releases/amd64/autobuilds/current-install-amd64-minimal/}
    \end{itemize}
    \item \textbf{Verify download: @todo}
\end{enumerate}

\section{USB preparation}
\begin{enumerate}
    \item \textbf{Unmount USB FS!}
    \item \textbf{Flash image to USB:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{dd} if=<\textcolor{file}{./install-amd64-minimal-<release>.iso}> of=<\textcolor{block}{/dev/sdX}>
[conv=fsync] [bs=4M] [status=progress]
\end{Verbatim}
\end{enumerate}

\section{Boot Live Installer}
\subsection{Secure Boot}
Make sure, that Secure Boot is disabled!
\begin{enumerate}
    \item \textbf{During POST press key to access BIOS/UEFI:}
\newline \href{https://techofide.com/blogs/boot-menu-option-keys-for-all-computers-and-laptops-updated-list-2021-techofide/}{https://techofide.com/blogs/boot-menu-option-keys-for-all-computers-and-laptops-updated-list-2021-techofide/}
    \item \textbf{Disable Secure Boot}
    \item \textbf{Poweroff/Restart}
\end{enumerate}
\subsection{Boot}
\begin{enumerate}
    \item \textbf{Plug in flashed USB}
    \item \textbf{During POST press key to access Boot Menu:}
\newline \href{https://techofide.com/blogs/boot-menu-option-keys-for-all-computers-and-laptops-updated-list-2021-techofide/}{https://techofide.com/blogs/boot-menu-option-keys-for-all-computers-and-laptops-updated-list-2021-techofide/}
    \item \textbf{Select USB entry (UEFI)}
\end{enumerate}


\chapter{Pre-Installation}
\section{Verify UEFI}
\begin{itemize}
    \item \textbf{UEFI is used if following directory exists:}
\newline \textbf{\textcolor{dir}{/sys/firmware/efi/}}
    \item \textbf{Or verify via kernel:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{dmesg} | \textcolor{command}{grep} -i efi
\end{Verbatim}
\end{itemize}

\section{Check Disk Sectors}
\subsection{Theory}
\begin{itemize}
    \item \textbf{Sector:} smallest unit size on disk. 512 or 4096 bytes.
    \item \textbf{Block:} allocation size the FS uses. Cannot be smaller than size of the sector. Can be group of sectors (4096b: 8 x 512b sectors).
    \begin{itemize}
        \item \textbf{512b =} good for lot of small files. More blocks = more metadata.
        \item \textbf{4096b =}  good for larger files, less metadata. Waste if there are mostly small files.
    \end{itemize}
\end{itemize}
\subsection{Disk Information}
\begin{itemize}
    \item \textbf{Find disks (block devices):}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{user}{user\$} \textcolor{command}{lsblk} [-ap | -apf]
\textcolor{root}{root#} \textcolor{command}{fdisk -l} [\textcolor{block}{/dev/sdX}]
\textcolor{root}{root#} \textcolor{command}{gdisk -l} <\textcolor{block}{/dev/sdX}>
\textcolor{root}{root#} \textcolor{command}{blkid}
\end{Verbatim}
    \item \textbf{Get raw disk info:}
    \begin{itemize}
        \item \textbf{Disk size in bytes:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{blockdev} [-v] --getsize64 <\textcolor{block}{/dev/sdX[Y]}>
\end{Verbatim}
    \item \textbf{Disk block size in bytes:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{blockdev} [-v] --getbsz <\textcolor{block}{/dev/sdX[Y]}>
\end{Verbatim}
    \item \textbf{Check if disk is readonly (1 = ro, 0 = rw):}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{blockdev} [-v] --getro <\textcolor{block}{/dev/sdX[Y]}>
\end{Verbatim}
    \end{itemize}
    \item \textbf{See partitions:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{parted} -s <\textcolor{block}{/dev/sdX}> (p)rint [free]
\end{Verbatim}
\end{itemize}
\subsection{Check Disk for bad sectors}
\begin{enumerate}
    \item \textbf{Unmount FS!}
    \item \textbf{Check disk for bad blocks:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{badblocks} [-b 4096] [-w [-t 0xaa]] [-v] [-s]
<\textcolor{block}{/dev/sdX[Y]}> | \textcolor{command}{tee} -a <\textcolor{file}{OUTPUT_FILE}>
\end{Verbatim}
\end{enumerate}

\section{Connect To The Internet @todo}
\begin{itemize}
    \item \textbf{Ethernet}

    \item \textbf{WiFi}
\end{itemize}

\section{Time Sync}
\begin{enumerate}
    \item \textbf{Synchronize local time to correctly access internet:}
\newline See section \ref{section:date}
\end{enumerate}


\chapter{Installation}
\section{Disk Partitioning}
\subsection{Partition Table}
\begin{enumerate}
    \item \textbf{Unmount FS!}
    \item \textbf{Create GPT partition table:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{parted} -s <\textcolor{block}{/dev/sdX}> mktable gpt
\end{Verbatim}
\end{enumerate}
\subsection{Basic Partitions}
\begin{enumerate}
    \item \textbf{Enter cfdisk:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{cfdisk} <\textcolor{block}{/dev/sdX}>
\end{Verbatim}
    \item \textbf{Create EFI partition (recommended 550 MiB):}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{cfdisk>} \textcolor{command}{n}
\textcolor{root}{cfdisk>} \textcolor{command}{550MiB}
\textcolor{root}{cfdisk>} \textcolor{command}{t}
\textcolor{root}{cfdisk>} \textcolor{command}{EFI System}
\end{Verbatim}
    \item \textbf{Create encrypted partition:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{cfdisk>} \textcolor{command}{n}
\textcolor{root}{cfdisk>} \textcolor{command}{ } (Enter)
\end{Verbatim}
    \item \textbf{Write changes:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{cfdisk>} \textcolor{command}{W}
\textcolor{root}{cfdisk>} \textcolor{command}{yes}
\end{Verbatim}
    \item \textbf{Quit cfdisk:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{cfdisk>} \textcolor{command}{Q}
\end{Verbatim}
    \item \textbf{Name partitions:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{parted} -s <\textcolor{block}{/dev/sdX}> name 1 ESP
\textcolor{root}{root#} \textcolor{command}{parted} -s <\textcolor{block}{/dev/sdX}> name 2 LUKS
\end{Verbatim}
    \item \textbf{Format partitions:}
    \begin{enumerate}
        \item \textbf{ESP:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{mkfs.fat} -F 32 <\textcolor{block}{/dev/sdX1}>
\textcolor{root}{root#} \textcolor{command}{fatlabel} <\textcolor{block}{/dev/sdX1}> <ESP>
\end{Verbatim}
        \item \textbf{LUKS:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{cryptsetup} luksFormat --label <LUKS> <\textcolor{block}{/dev/sdX2}>
> YES
> <PASSWORD>
> <PASSWORD (VERIFY)>
\end{Verbatim}
    \end{enumerate}
\end{enumerate}
    \subsection{Advanced LUKS stuff}
\begin{itemize}
    \item \textbf{Open LUKS:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{cryptsetup} open --type luks <\textcolor{block}{/dev/sdX2}> <luks>
> <PASSWORD>
\end{Verbatim}
    \item \textbf{Close LUKS:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{cryptsetup} close <luks>
\end{Verbatim}
    \item \textbf{LUKS header:}
    \begin{enumerate}
        \item \textbf{See LUKS header:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{cryptsetup} luksDump <\textcolor{block}{/dev/sdX2}>
\end{Verbatim}
        \item \textbf{Make LUKS header backup:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{cryptsetup} luksHeaderBackup <\textcolor{block}{/dev/sdX2}>
--header-backup-file <\textcolor{file}{FILE}>
\end{Verbatim}
        \item \textbf{Destroy LUKS header:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{cryptsetup} luksErase <\textcolor{block}{/dev/sdX2}>
> YES
\end{Verbatim}
        \item \textbf{Restore LUKS header:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{cryptsetup} luksHeaderRestore <\textcolor{block}{/dev/sdX2}>
--header-backup-file <\textcolor{file}{FILE}>
> YES
\end{Verbatim}
    \end{enumerate}
    \item \textbf{Passwords}
    \begin{itemize}
        \item \textbf{Change password:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{cryptsetup} luksChangeKey <\textcolor{block}{/dev/sdX2}>
> <OLD_PASSWORD>
> <NEW_PASSWORD>
> <NEW_PASSWORD (VERIFY)>
\end{Verbatim}
    \end{itemize}
\end{itemize}
\subsection{Encrypted Partition}
\begin{figure}[ht]
    \begin{center}
        \includegraphics[width=115mm]{./src/img/btrfs.png}
        \caption{LVM structure.}
        \label{fig:1}
    \end{center}
\end{figure}
\begin{enumerate}
    \item \textbf{Open encrypted partition:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{cryptsetup} open --type luks <\textcolor{block}{/dev/sdX2}> <luks_lvm>
> <PASSWORD>
\end{Verbatim}
    \item \textbf{Create LVM Physical Volume:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{lvm} pvcreate <\textcolor{block}{/dev/mapper/luks_lvm}>
\end{Verbatim}
    \item \textbf{Create LVM Volume Group:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{lvm} vgcreate <vg0> <\textcolor{block}{/dev/mapper/luks_lvm}>
\end{Verbatim}
    \item \textbf{Create LVM Logical Volumes:}
    \begin{enumerate}
        \item \textbf{SWAP volume (4GB):}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{lvm} lvcreate -L 4G -n <swap> <vg0>
\end{Verbatim}
        \item \textbf{Root Logical Volume:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{lvm} lvcreate -l 100\%FREE -n <root> <vg0>
\end{Verbatim}
    \end{enumerate}
    \item \textbf{Verify LVM}
    \begin{itemize}
        \item \textbf{Check LVM Physical Volumes:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{lvm} pvdisplay
\end{Verbatim}
        \item \textbf{Check LVM Volume Groups:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{lvm} vgdisplay [vg0]
\end{Verbatim}
        \item \textbf{Check LVM Logical Volumes:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{lvm} lvdisplay
\end{Verbatim}
    \end{itemize}
    \item \textbf{Format LVM Logical Volumes:}
    \begin{enumerate}
        \item \textbf{SWAP partition:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{mkswap} [-L <LVM_SWAP>] <\textcolor{block}{/dev/mapper/vg0-swap}>
\textcolor{root}{root#} \textcolor{command}{swapon} <\textcolor{block}{/dev/mapper/vg0-swap}>
\end{Verbatim}
        \item \textbf{Root Partition:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{mkfs.btrfs} <\textcolor{block}{/dev/mapper/vg0-root}>
\textcolor{root}{root#} \textcolor{command}{btrfs} filesystem label <\textcolor{block}{/dev/mapper/vg0-root}> <LVM_ROOT>
\end{Verbatim}
    \end{enumerate}
\end{enumerate}

\section{Stage3}
\begin{enumerate}
    \item \textbf{Mount Gentoo:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{mount} <\textcolor{block}{/dev/mapper/vg0-root}> <\textcolor{dir}{/mnt/gentoo/}>
\end{Verbatim}
    \item \textbf{Navigate to Gentoo install directory:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{cd} <\textcolor{dir}{/mnt/gentoo/}>
\end{Verbatim}
    \item \textbf{Download Stage3 (from DK mirror):}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{links} https://www.gentoo.org/downloads/mirrors/
\end{Verbatim}
\menu[,]{DK, https://mirrors.dotsrc.org/gentoo/, releases/, amd64/, autobuilds/, current-stage3-amd64-openrc/, stage3-amd64-openrc-<release>.tar.xz}
    \item \textbf{Verify download: @todo}
    \item \textbf{Extract Stage3 tarball:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{tar} xvJpf <\textcolor{file}{./stage3-amd64-openrc-<release>.tar.xz}>
--xattrs-include='*.*' --numeric-owner
\end{Verbatim}
    \item \textbf{Remove tar:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{rm} -f <\textcolor{file}{./stage3-amd64-openrc-<release>.tar.xz}>
\end{Verbatim}
    \item \textbf{Copy Gentoo ebuild repository:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{mkdir} -p \textcolor{dir}{/mnt/gentoo/etc/portage/repos.conf/}
\textcolor{root}{root#} \textcolor{command}{cp} \textcolor{file}{/mnt/gentoo/usr/share/portage/config/repos.conf}
\textcolor{file}{/mnt/gentoo/etc/portage/repos.conf/gentoo.conf}
\end{Verbatim}
\end{enumerate}

\section{Chroot}
\begin{enumerate}
    \item \textbf{Mount all filesystems:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{mount} -t proc \textcolor{dir}{/proc/} <\textcolor{dir}{/mnt/gentoo/proc/}>
\textcolor{root}{root#} \textcolor{command}{mount} --rbind \textcolor{dir}{/sys/} <\textcolor{dir}{/mnt/gentoo/sys/}>
\textcolor{root}{root#} \textcolor{command}{mount} --make-rslave <\textcolor{dir}{/mnt/gentoo/sys/}>
\textcolor{root}{root#} \textcolor{command}{mount} --rbind \textcolor{dir}{/dev/} <\textcolor{dir}{/mnt/gentoo/dev/}>
\textcolor{root}{root#} \textcolor{command}{mount} --make-rslave <\textcolor{dir}{/mnt/gentoo/dev/}>
\textcolor{root}{root#} \textcolor{command}{mount} --bind \textcolor{dir}{/run/} <\textcolor{dir}{/mnt/gentoo/run/}>
\textcolor{root}{root#} \textcolor{command}{mount} --make-slave <\textcolor{dir}{/mnt/gentoo/run/}>
\end{Verbatim}
    \item \textbf{Chroot:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{chroot} <\textcolor{dir}{/mnt/gentoo/}> \textcolor{file}{/bin/bash}
\textcolor{root}{root#} \textcolor{command}{source} \textcolor{file}{/etc/profile}
\textcolor{root}{root#} \textcolor{command}{export} PS1="(chroot) \$\{PS1\}"
\end{Verbatim}
    \item \textbf{Mount boot partition:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{mount} <\textcolor{block}{/dev/sdX1}> \textcolor{dir}{/boot/}
\end{Verbatim}
    \item \textbf{Add DNS:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{echo} "nameserver 1.1.1.1" > \textcolor{file}{/etc/resolv.conf}
\end{Verbatim}
\end{enumerate}

\section{Portage}
\begin{enumerate}
    \item \textbf{Find amount of available processing units:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{user}{(chroot) user\$} \textcolor{command}{nproc}
\end{Verbatim}
    \item \textbf{Configure compile options:}
\newline File (\textbf{\textcolor{file}{/etc/portage/make.conf}}):
\newline \url{https://github.com/AISK11/Gentoo/blob/main/configs/make.conf}
    \item \textbf{Create per-package license exceptions file:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{touch} \textcolor{file}{/etc/portage/package.license}
\end{Verbatim}
\end{enumerate}

\section{System Recompilation}
\begin{enumerate}
    \item \textbf{Synchronize repository:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --sync
\end{Verbatim}
    \item \textbf{Read the news}
    \begin{itemize}
        \item \textbf{List all available news:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{eselect} news list
\end{Verbatim}
        \item \textbf{Read all/specific news:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{eselect} news read [N]
\end{Verbatim}
        \item \textbf{Purge all/specific news:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{eselect} news purge [N]
\end{Verbatim}
    \end{itemize}
    \item \textbf{Check selected profile:}
\newline Profile has to match downloaded Stage3 tarball!
    \begin{itemize}
        \item \textbf{See current profile:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{eselect} profile list
\end{Verbatim}
        \item \textbf{Change profile:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{eselect} profile set <N>
\end{Verbatim}
    \end{itemize}
    \item \textbf{Compile full system:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --ask --verbose --update --deep --newuse @world
\end{Verbatim}
\end{enumerate}

\section{Local System Settings}
See section \ref{section:local_settings}

\section{Fstab}
\begin{enumerate}
    \item \textbf{Find UUIDs for block devices:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{blkid}
\end{Verbatim}
    \item \textbf{Configure fstab:}
\newline File (\textbf{\textcolor{file}{/etc/fstab}}):
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{comment}{## <disk UUID>         <mount>   <fs>  <options>     <dump> <pass>}
UUID=<UUID_(sdX1)>     /boot/    vfat  umask=0077              0 1
UUID=<UUID_(vg0-swap)> none      swap  sw                      0 0
UUID=<UUID_(vg0-root)> /         btrfs defaults,noatime,nofail 0 0
\end{Verbatim}
\end{enumerate}

\section{System Packages}
\begin{enumerate}
    \item \textbf{Intel Microcode + Basic firmware (AMD microcode + iwlwifi):}
\newline File (\textbf{\textcolor{file}{/etc/portage/package.license}}):
\begin{Verbatim}[commandchars=\\\{\}]
sys-firmware/intel-microcode @BINARY-REDISTRIBUTABLE
sys-kernel/linux-firmware @BINARY-REDISTRIBUTABLE
\end{Verbatim}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --ask sys-firmware/intel-microcode
sys-kernel/linux-firmware
\end{Verbatim}
    \item \textbf{Filesystems (FAT32, LUKS, LVM2, BTRFS):}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --ask sys-fs/dosfstools sys-fs/cryptsetup
sys-fs/lvm2 sys-fs/btrfs-progs
\end{Verbatim}
    \item \textbf{UEFI:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --ask sys-boot/efibootmgr sys-boot/refind
\end{Verbatim}
    \item \textbf{Init system (runit):}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --ask sys-process/runit
\end{Verbatim}
    \item \textbf{Network:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --ask net-misc/dhcpcd net-wireless/wpa_supplicant
\end{Verbatim}
\end{enumerate}

\section{Kernel}
\url{https://www.kernelconfig.io}
\begin{enumerate}
    \item \textbf{Install kernel source:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --ask sys-kernel/gentoo-sources
\end{Verbatim}
    \item \textbf{Install initramfs:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --ask sys-kernel/dracut
\end{Verbatim}
    \item \textbf{Create linux kernel symlink:}
    \begin{enumerate}
        \item \textbf{List available kernels:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{eselect} kernel list
\end{Verbatim}
        \item \textbf{Create symlink}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{eselect} kernel set <1>
\end{Verbatim}
    \end{enumerate}
    \item \textbf{Enter kernel configuration:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{cd} \textcolor{dir}{/usr/src/linux/} && \textcolor{command}{make} menuconfig
\end{Verbatim}
    \item \textbf{Configure kernel}
    \begin{enumerate}
        \item \textbf{CPU:}
\begin{Verbatim}[commandchars=\\\{\}]
Processor type and features --->
   [*] Intel MCE features
   [ ] AMD MCE features
   [*] CPU microcode loading support
   [*]   Intel microcode loading support
   [ ]   AMD microcode loading support
\end{Verbatim}
        \item \textbf{Hard Drive:}
\begin{Verbatim}[commandchars=\\\{\}]
Device Drivers →
  NVME Support →
    <*> NVM Express block device
\end{Verbatim}
        \item \textbf{RAID:}
\begin{Verbatim}[commandchars=\\\{\}]
Device Drivers  --->
   Multiple devices driver support (RAID and LVM)  --->
       < > RAID support
\end{Verbatim}
    \item \textbf{GPT}
\begin{Verbatim}[commandchars=\\\{\}]
-*- Enable the block layer --->
   Partition Types --->
      [ ] PC BIOS (MSDOS) partition tables) support
      [*] Advanced partition selection
      [*] EFI GUID Partition support
\end{Verbatim}
        \item \textbf{LVM:}
\begin{Verbatim}[commandchars=\\\{\}]
Device Drivers  --->
   Multiple devices driver support (RAID and LVM)  --->
       <*> Device mapper support
           <*> Crypt target support
           <*> Snapshot target
           <*> Mirror target
           <*> Multipath target
               <*> I/O Path Selector based on the number of in-flight I/Os
               <*> I/O Path Selector based on the service time
\end{Verbatim}
        \item \textbf{LUKS:}
\begin{Verbatim}[commandchars=\\\{\}]
[*] Cryptographic API --->
    <*> XTS support
    <*> User-space interface for hash algorithms
    <*> User-space interface for symmetric key cipher algorithms
\end{Verbatim}
        \item \textbf{Filesystems:}
\begin{Verbatim}[commandchars=\\\{\}]
File systems --->
  < > Second extended fs support
  < > The Extended 3 (ext3) filesystem
  <*> The Extended 4 (ext4) filesystem
  < > XFS filesystem support
  <*> Btrfs filesystem support
  DOS/FAT/EXFAT/NT Filesystems  --->
    <*> MSDOS fs support
    <*> VFAT (Windows-95) fs support
\end{Verbatim}
        \item \textbf{WiFi:}
\begin{Verbatim}[commandchars=\\\{\}]
Device Drivers  --->
        [*] Network device support  --->
        --- Network device support
        [*]   Wireless LAN  --->
            --- Wireless LAN
            <M>     Intel Wireless WiFi Next Gen AGN -
                    Wireless-N/Advanced-N/Ultimate-N (iwlwifi)
            <M>     Intel Wireless WiFi DVM Firmware support
            <M>     Intel Wireless WiFi MVM Firmware support
\end{Verbatim}
    \end{enumerate}
    \item \textbf{Compile kernel:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{cd} \textcolor{dir}{/usr/src/linux/} && \textcolor{command}{make} && \textcolor{command}{make} modules_install
\end{Verbatim}
    \item \textbf{Copy kernel to boot dir:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{(chroot) root#} \textcolor{command}{cd} \textcolor{dir}{/usr/src/linux/} && \textcolor{command}{make} install
\end{Verbatim}
\end{enumerate}


\chapter{Local Settings WIP}
\label{section:local_settings}
\section{Hostname}
\begin{itemize}
    \item \textbf{Print [full] hostname:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{user}{user\$} \textcolor{command}{hostname} [-f]
\end{Verbatim}
    \item \textbf{Change hostname:}
    \begin{enumerate}
        \item \textbf{Change hostname permanently:}
\newline File (\textbf{\textcolor{file}{/etc/hostname}}):
\begin{verbatim}
<HOSTNAME>
\end{verbatim}
    \item \textbf{Reboot PC to take effect:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{reboot}
\end{Verbatim}
    \end{enumerate}
\end{itemize}

\section{Date \& Time}
\subsection{Timezone}
\begin{itemize}
    \item \textbf{Show current timezone:}
\newline Has to be created during installation.
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{user}{user\$} \textcolor{command}{cat} \textcolor{file}{/etc/timezone}
\end{Verbatim}
    \item \textbf{Change timezone:}
    \begin{enumerate}
        \item \textbf{See available timezones:}
\newline Directory (\textbf{\textcolor{dir}{/usr/share/zoneinfo/}}).
        \item \textbf{Set timezone:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{echo} "<Europe/Copenhagen>" > \textcolor{file}{/etc/timezone}
\textcolor{root}{root#} \textcolor{command}{emerge} --config sys-libs/timezone-data
\end{Verbatim}
    \end{enumerate}
\end{itemize}
\subsection{System Clock}
\label{section:date}
\begin{itemize}
    \item \textbf{Show system time:}
    \begin{itemize}
        \item \textbf{Default:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{user}{user\$} \textcolor{command}{date}
\end{Verbatim}
        \item \textbf{ISO 8601 (YYYY-MM-DDThh:mm:ss(+|-)xx:xx):}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{user}{user\$} \textcolor{command}{date} +'\%Y-\%m-\%dT\%H:\%M:\%S\%:z'
\end{Verbatim}
    \end{itemize}
    \item \textbf{Set system time:}
    \begin{itemize}
        \item \textbf{Manually:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{date} <MMDDhhmmYYYY>
\end{Verbatim}
        \item \textbf{With NTP/PTP @todo}
    \end{itemize}
\end{itemize}
\subsection{Hardware Clock (RTC)}
\begin{itemize}
    \item \textbf{Display RTC:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{hwclock}
\end{Verbatim}
    \item \textbf{Update RTC with system clock:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{hwclock} --systohc
\end{Verbatim}
\end{itemize}

\section{Locales}
\begin{itemize}
    \item \textbf{See locales:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{user}{user\$} \textcolor{command}{locale}
\end{Verbatim}
    \item \textbf{Set locales:}
    \begin{enumerate}
        \item \textbf{List available locales:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{user}{user\$} \textcolor{command}{cat} \textcolor{file}{/usr/share/i18n/SUPPORTED}
\end{Verbatim}
        \item \textbf{Generate locales:}
\newline File (\textbf{\textcolor{file}{/etc/locale-gen}}):
\newline \url{https://github.com/AISK11/Gentoo/blob/main/configs/locale-gen}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{locale-gen}
\end{Verbatim}
    \item \textbf{List available generated locales:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{user}{user\$} \textcolor{command}{locale} -a
\end{Verbatim}
    \item \textbf{Set system locales:}
\newline File (\textbf{\textcolor{file}{/etc/env.d/02locale}}):
\newline \url{https://github.com/AISK11/Gentoo/blob/main/configs/02locale}
    \item \textbf{Use changed locales:}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{env-update} && \textcolor{command}{source} \textcolor{file}{/etc/profile}
\end{Verbatim}
    \end{enumerate}
\end{itemize}

\section{Console Keyboard}
\begin{enumerate}
    \item \textbf{See all available keyboards:}
\newline File (\textbf{\textcolor{file}{/etc/env.d/02locale}}):
\newline Directory (\textbf{\textcolor{dir}{/usr/share/keymaps/i386/}}).
    \item \textbf{Set keyboard:}
\newline File: (\textbf{\textcolor{file}{/etc/conf.d/keymaps}}):
\begin{verbatim}
keymap="us"
\end{verbatim}
\end{enumerate}

\chapter{Portage}
\begin{itemize}
    \item eselect [news]
    \item emerge
    \item layman?
\end{itemize}


% https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Base
% https://wiki.gentoo.org/wiki/Localization/Guide#Environment_variables_for_locales
% https://wiki.archlinux.org/title/Locale
% https://www.gnu.org/software/libc/manual/html_node/Locale-Categories.html#index-LC_005fTIME





% ToDo:
% Locale + CLI keyboard, font, etc
% Kernel + initramfs
% efibootmgr + rEFInd
% runit
% ZSH
% xen
% SELINUX
% hardened kernel

% Networking
% Portage + Pentoo

% System hardening (nftables, usbguard, no motd, ulimits, ...)

\end{document}
